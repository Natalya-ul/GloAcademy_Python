import os
import jsonpickle

class FileProvider:
    def get(self, path):
        file = open(path, 'r')
        data = file.read()
        file.close()
        return data

    def writelines(self, path, data):
        file = open(path, 'w')
        data = file.writelines(data)
        file.close()        
        
    def exist(self, path):
        return os.path.exists(path)

class School():
    def __init__(self, name, address, count_students=0):
        self.name = name
        self.address = address
        self.count_students = count_students

class SchoolStorage():
    def __init__(self):
        self.file_name = 'school.json'

    def safe(self, school):
        json_data = jsonpickle.encode(school)
        file_provider.writelines(self.file_name, json_data)

    def get_all(self):
        if not file_provider.exist(self.file_name):
            print('Здравствуйте! Введите информацию о школе:')
            print('Введите название школы:')
            school_name = check_input_text()
            print('Введите адрес школы:')
            school_address = check_input_text()
            school = School(school_name, school_address)
            self.safe(school)
            print(f'Школа "{school.name}" создана! Адрес школы: {school.address}')            
            
        data = file_provider.get(self.file_name)
        school = jsonpickle.decode(data)
        return school
    
    def change_name(self):
        print('Введите новое название школы:')
        school = self.get_all()
        new_name = check_input_text()
        school.name = new_name
        self.safe(school)
        print(f'Название изменено! Новое название школы: {school.name}')
        
    def change_address(self):
        school = self.get_all()
        print('Введите новый адрес школы:')
        new_address = check_input_text()
        school.address = new_address
        self.safe(school)
        print(f'Адрес изменен! Новый адрес школы: {school.address}')

class Student():
    def __init__(self, name, age, number_class):
        self.name = name
        self.age = age
        self.number_class = number_class

class MenuStorage():
    def get_menu(self):
        menu = [
            'Получение полной информации о школе',
            'Изменение информации о школе',
            'Просмотр учеников школы в виде таблицы',
            'Добавление нового ученика школы',
            'Удаление имеющегося ученика школы']

        return menu

    def print_menu(self, menu):
        print('Меню:')
        print('---------------------------------------')
        for i in range(len(menu)):
                    print(f'{i+1}.{menu[i]}')
        print('---------------------------------------')

    def get_item_number(self):
        print('Введите номер пункта меню, который хотите выбрать:')
        selected_menu_item = check_get_item()
        self.use_menu(selected_menu_item)
        
    def use_menu(self, number):
        if number == 1:
            school = schoolStorage.get_all()
            print(f'Название школы: {school.name}')
            print(f'Адрес школы: {school.address}')
            print(f'Кол-во учеников школы: {school.count_students}')
            self.return_menu()

        if number == 2:
            if ask_question('Хотите изменить название школы?'):
                schoolStorage.change_name()
            if ask_question('Хотите изменить адрес школы?'):
                schoolStorage.change_address()
            self.return_menu()

    def return_menu(self):
        if ask_question('Хотите вернуться в меню?'):
            self.print_menu(menu)
            self.get_item_number()

def ask_question(question):
    print(question, 'Введите Да или Нет.')
    answer = input().lower()
    while answer != 'да' and answer != 'нет':
        print('Ответ некорректный! Возможные варианты ввода: Да или Нет')
        answer = input().lower()
    if answer == 'да':
        return True
    else:
        return False

def check_get_item():
    user_answer = input()
    while not user_answer.isdigit() or int(user_answer) < 1 or int(user_answer) > len(menu):
        print(f'Введите число от 1 до {len(menu)}!')
        user_answer = input()
    return int(user_answer)

def check_input_text():
    user_answer = input()
    user_answer_str = user_answer.replace(" ", "")
    while user_answer_str == '':
        print(f'Введена пустая строка! Попробуйте снова.')
        user_answer = input()
        user_answer_str = user_answer.replace(" ", "")
    return user_answer
        

file_provider = FileProvider()
menu_storage = MenuStorage()
menu = menu_storage.get_menu()
schoolStorage = SchoolStorage()
school = schoolStorage.get_all()

print(f'Добро пожаловать в школу "{school.name}"')
menu_storage.print_menu(menu)
menu_storage.get_item_number()
